<!DOCTYPE html>
<html lang="zh">

<link href="/static/css/rg_base.css" rel="stylesheet" type="text/css" id="rg_base">
<link href="/static/css/rg_config.css" rel="stylesheet" type="text/css" id="rg_config">
<link href="/static/css/login.css" rel="stylesheet" type="text/css">
<link href="/static/css/weui-for-work.min.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="/static/js/login.js?ver=1"></script>
<script type="text/javascript" src="/static/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/rg_base.js?ver=1"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=1.0, user-scalable=yes"/>
    <title>ÁôªÈôÜ</title>
</head>
<body>
<div class="hina_bg"></div>
<div class="page_wrapper main_title_color">
    <div class="page_center_wrapper">
        <div style="width: 75%; min-width: 120px; max-width: 260px; background-color: rgba(0,0,0,0); display: flex; flex-direction: column">

            <div style="font-size: 35px;">BLOG</div>

            <div class="weui-cells" style="border-radius: 8px">
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <input class="weui-input login_input" placeholder="Áî®Êà∑Âêç" id="user" type="text"/>
                    </div>
                    <div class="weui-cell__ft">
                        <div class="login_button" id="login_btn_user"></div>
                    </div>
                </div>

                <div class="weui-cell" id="pwd_wapper">
                    <div class="weui-cell__bd">
                        <input class="weui-input login_input" placeholder="ÂØÜÁ†Å" id="pwd" type="password"/>
                    </div>
                    <div class="weui-cell__ft">
                        <div class="login_button" id="login_btn_pwd"></div>
                    </div>
                </div>
            </div>

            <div>
                <div id="login_tip" class="login_tip main_title_color"></div>
            </div>

            <div>
                <a style="cursor: pointer; float: right;">ÂøòËÆ∞ÂØÜÁ†Å</a>
            </div>
            <div style="text-align: center">
                <div class="si-remember-password">
                    <input type="checkbox" id="remember-me" class="form-choice form-choice-checkbox" onchange="checkRemember(this)" >
                    <label class="form-label" for="remember-me">
                        <span class="form-choice-indicator"></span>ËÆ∞‰ΩèÁôªÈôÜÁä∂ÊÄÅ
                    </label>
                </div>
            </div>

            <div>
                <div style="text-align: center; margin-top: 30px">
                    <!--<div style="padding: 0 1px;margin: 20px 0">-->
                        <!--<div class="main_title_color_background" style="height: 1px;"></div>-->
                    <!--</div>-->
                    <div>
                        <span id="mode_desc">Ê≤°ÊúâË¥¶Âè∑Ôºü</span>
                        <a id="mode_action" style="cursor: pointer" onclick="switchMode()">Á´ãÂç≥Ê≥®ÂÜå„ÄÇ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    preventEnterEnable(true, function (e) {
        if (e.target.id === 'user') {
            check_user()
        } else if (e.target.id === 'pwd') {
            login_user()
        }
    })

    var that = this
    $(function () {

        that.registMode = false
        that.remember = 0

        login_hidden('#pwd_wapper', true, 0, null)

        $('#login_btn_user').click(check_user)
        $('#login_btn_pwd').click(login_user)

        $("#user").on("input", function (e) {
            if (that.lastvalue === e.target.value) {
                return
            }
            that.lastvalue = e.target.value

            hidePwdInputView()
            show_tip('')
        });
    })

    function hidePwdInputView(clearText=false) {
        $('#login_btn_user').removeClass('weui-loading')
        $('#login_btn_user').addClass('login_button')

        $('#login_btn_pwd').removeClass('weui-loading')
        $('#login_btn_pwd').addClass('login_button')


        login_hidden('#pwd_wapper', true, 200, null)
        if (clearText)
            $('#pwd').val('')
    }

    function check_user() {

        let username = $('#user').val()
        if (!username || username.length <= 0) {
            show_tip('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÔ∏è')
            return
        }

        $('#login_btn_user').removeClass('login_button')
        $('#login_btn_user').addClass('weui-loading')

        check(username, function (data) {

            $('#login_btn_user').removeClass('weui-loading')

            let showPwd = (data.code === 1000 && !that.registMode) || (data.code === 1001 && that.registMode)

            if (showPwd) {
                login_hidden('#login_btn_pwd', true, 0, function () {
                    login_hidden('#pwd_wapper', false, 200, function () {
                    $('#pwd').focus()
                    login_hidden('#login_btn_pwd', false, 80, function () {
                        if (that.registMode) {
                            show_tip('ËØ∑ËæìÂÖ•ÂØÜÁ†Å‰ª•ÂÆåÊàêÊ≥®ÂÜå')
                        } else {

                        }
                    })
                })
                })
            } else {
                login_hidden('#login_btn_pwd', true, 0, function () {
                    if (that.registMode) {
                    show_tip('ËØ•Áî®Êà∑Â∑≤Ê≥®ÂÜå ËØ∑Áõ¥Êé•ÁôªÈôÜ')
                } else {
                    show_tip('ËØ•Áî®Êà∑Êú™Ê≥®ÂÜå ËØ∑ÁÇπÂáªÁ´ãÂç≥Ê≥®ÂÜå')
                }
                })
            }
        })
    }

    function switchMode() {

        that.registMode = !that.registMode
        if (this.registMode) {
            $('#mode_desc').text('Â∑≤ÊúâË¥¶Âè∑Ôºå')
            $('#mode_action').text('ÂéªÁôªÈôÜ„ÄÇ')
        } else {
            $('#mode_desc').text('Ê≤°ÊúâË¥¶Âè∑Ôºü ')
            $('#mode_action').text('Á´ãÂç≥Ê≥®ÂÜå„ÄÇ')
        }

        hidePwdInputView(true)
        show_tip('')

        let username = $('#user').val()

        if (that.registMode) {
            if (!username.length) {
                $('#user').focus()
                login_hidden('#pwd_wapper', true, 200, function () {
                    show_tip('ËØ∑ËæìÂÖ•Ê≥®ÂÜåÁî®Êà∑Âêç')
                })
            } else {
                check_user()
            }
        } else {
            if (!username.length) {
                $('#user').focus()
                login_hidden('#pwd_wapper', true, 200, function () {
                    show_tip('ËØ∑ËæìÂÖ•ÁôªÈôÜÁî®Êà∑Âêç')
                })
            } else {
                check_user()
            }
        }
    }

    function login_user() {
        let username = $('#user').val()
        let pwd = $('#pwd').val()

        if (!username.length || !pwd.length) {
            show_tip('Áî®Êà∑ÂêçÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫')
            return;
        }


        $('#login_btn_pwd').removeClass('login_button')
        $('#login_btn_pwd').addClass('weui-loading')

        if (that.registMode) {
            regist(username, pwd, that.remember, function (data) {

                $('#login_btn_pwd').removeClass('weui-loading')

                code = data.code
                if (code == 1000) {
                    // login ok, redirt
                    this.redirt()
                } else if (code == 1001) {
                    $('#login_btn_pwd').addClass('login_button')
                    show_tip('ÊúçÂä°Âô®ÂºÇÂ∏∏üôÜ‚Äç‚ôÄÔ∏è')
                }
            })
        } else {
            login(username, pwd, that.remember, function (data) {

                $('#login_btn_pwd').removeClass('weui-loading')

                code = data.code
                if (code == 1000) {
                    // login ok, redirt
                    this.redirt()
                } else if (code === 1001) {
                    $('#login_btn_pwd').addClass('login_button')
                    show_tip('ÂØÜÁ†Å‰∏çÊ≠£Á°ÆüôÜ‚Äç‚ôÄÔ∏è')
                } else {
                    $('#login_btn_pwd').addClass('login_button')
                    show_tip('ÊúçÂä°Âô®ÂºÇÂ∏∏üôÜ‚Äç‚ôÄÔ∏è')
                }
            })
        }
    }

    function redirt() {
        let default_href = 'blog'
                    let prevLink = document.referrer;
                    if ($.trim(prevLink) === '') {
                        location.href = default_href
                    } else {
                        if (prevLink.indexOf('www.example.com') === -1) {	//Êù•Ëá™ÂÖ∂ÂÆÉÁ´ôÁÇπ
                            location.href = default_href
                        }
                        if (prevLink.indexOf('register.html') !== -1) {		//Êù•Ëá™Ê≥®ÂÜåÈ°µÈù¢
                            location.href = default_href
                        }
                        location.href = prevLink
                    }
    }

    function login_hidden(id, hide, time, callback) {
        if (hide) {
            $(id).hide(time, callback)
        } else {
            $(id).show(time, callback)
        }
    }

    function checkRemember(e) {
        that.remember = e.checked?1:0
    }

    function show_tip(tip) {
        $('#login_tip').html(tip)
    }
</script>
</body>
</html>